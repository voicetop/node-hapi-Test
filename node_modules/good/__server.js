var Fs = require('fs');
var Hapi = require('hapi');
var Good = require('./lib');

Fs.unlinkSync('__log.log');

var server = new Hapi.Server();
server.connection({ host: 'localhost', port: 9001});

var goodOptions = {
    opsInterval: 1000,
    requestHeaders: true,
    //requestPayload: true,
    responsePayload: true,
    responseEvent: 'tail',
    filter: {
        testfield: "censor"
    },
    reporters: [{
        reporter: require('good-console'),
        events: {
            response: '*',
            error: '*',
            log: '*',
            request: '*',
            ops: '*'
        }
    }, {
        reporter: 'good-file',
        events: {
            request: '*',
            response: '*'
        },
        config: './__log.log'
    }]
};

goodOptions.reporters.shift();

server.route({
    method: 'get',
    path: '/',
    handler: function (request, reply) {

        reply('HI!');
    }
});

server.register({
    register: Good,
    options: goodOptions
}, function (err) {

    if (err) {
        console.error(err);
    }
    else {
        server.start(function () {

            console.info('Server started at ' + server.info.uri);
        });
    }
});
